{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout - Molla{% endblock %}
{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
{% endblock %}
{% block content %}

<style>
    .btn-place-order {
        background-color: crimson;
        color: #fff;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        transition: background-color 0.3s ease;
        cursor: pointer;
    }

    .btn-place-order:hover {
        background-color: darkred;
        color: #fff;
    }
</style>

<div class="container my-5">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-5 ">
        <ol class="breadcrumb bg-light p-3 rounded shadow-sm d-flex">
            <li class="breadcrumb-item"><a href="" class="text-decoration-none">Home</a></li>
            <li class="breadcrumb-item"><a href="" class="text-decoration-none">Shop</a></li>
            <li class="breadcrumb-item active" aria-current="page">Checkout</li>
        </ol>
    </nav>

    <div class="d-flex">
        <div class="col-lg-7">
            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-body p-4">
                    <h4 class="title mb-4 fw-bold">Billing Details</h4>
                    <form action="{% url 'checkout' %}" method="POST">
                        {% csrf_token %}

                        <!-- Name -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="first_name" class="form-label fw-semibold">First Name *</label>
                                <input type="text" class="form-control form-control-lg" name="first_name"
                                    id="first_name" value="{{ request.user.first_name }}" required>
                            </div>
                            <div class="col-md-6">
                                <label for="last_name" class="form-label fw-semibold">Last Name *</label>
                                <input type="text" class="form-control form-control-lg" name="last_name" id="last_name"
                                    value="{{ request.user.last_name }}" required>
                            </div>
                        </div>

                        <!-- Company -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Company Name (Optional)</label>
                            <input type="text" class="form-control form-control-lg" name="company_name"
                                placeholder="Your company name">
                        </div>

                        <!-- Country -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Country *</label>
                            <select name="country" class="form-select form-select-lg">
                                <option value="Bangladesh">Bangladesh</option>
                                <option value="United States">United States</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Canada">Canada</option>
                                <option value="Australia">Australia</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-semibold">Street Address *</label>
                            <input type="text" class="form-control form-control-lg mb-2" name="address_line1"
                                placeholder="House number and street name" required>
                            <input type="text" class="form-control form-control-lg" name="address_line2"
                                placeholder="Apartment, suite, unit etc. (optional)">
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Town / City *</label>
                                <input type="text" class="form-control form-control-lg" name="city" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">State / County *</label>
                                <input type="text" class="form-control form-control-lg" name="state" required>
                            </div>
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Postcode / ZIP *</label>
                                <input type="text" class="form-control form-control-lg" name="postal_code" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Phone *</label>
                                <input type="tel" class="form-control form-control-lg" name="phone" required>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-semibold">Email Address *</label>
                            <input type="email" class="form-control form-control-lg bg-light"
                                value="{{ request.user.email }}" readonly>
                        </div>

                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="createAccount">
                            <label class="form-check-label fw-semibold" for="createAccount">Create an account?</label>
                        </div>

                        <div class="form-check mb-4">
                            <input type="checkbox" class="form-check-input" id="shipDifferent">
                            <label class="form-check-label fw-semibold" for="shipDifferent">Ship to a different
                                address?</label>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-semibold">Order Notes (Optional)</label>
                            <textarea class="form-control form-control-lg" name="order_notes" rows="4"
                                placeholder="Notes about your order"></textarea>
                        </div>

                </div>
            </div>
        </div>


        <div class="col-lg-5">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h4 class="mb-4">Your Order</h4>

                    <ul class="list-group mb-4">
                        {% for item in cart.items.all %}
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div>
                                <div class="fw-semibold">
                                    {{ item.variant.product.name }}
                                </div>
                                <small class="text-muted">
                                    Size: {{ item.variant.size }},
                                    Color: {{ item.variant.color }}
                                </small>
                            </div>
                            <span class="fw-bold">
                                ${{ item.subtotal }}
                            </span>
                        </li>
                        {% endfor %}

                        <li class="list-group-item d-flex justify-content-between">
                            <span>Subtotal</span>
                            <span>${{ subtotal }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Shipping</span>
                            <span>Free</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between fw-bold">
                            <span>Total</span>
                            <span>${{ total }}</span>
                        </li>
                    </ul>

                    <!-- Payment -->
                    <div class="accordion mb-4" id="paymentAccordion">
                        <!-- SSLCommerz -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSsl">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseSsl" aria-expanded="true" aria-controls="collapseSsl">
                                    SSLCommerz
                                </button>
                            </h2>
                            <div id="collapseSsl" class="accordion-collapse collapse show" aria-labelledby="headingSsl"
                                data-bs-parent="#paymentAccordion">
                                <div class="accordion-body">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="payment_type" id="ssl"
                                            value="sslcommerz" checked>
                                        <label class="form-check-label" for="ssl">
                                            Pay securely via SSLCommerz
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cash on Delivery -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingCod">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseCod" aria-expanded="false" aria-controls="collapseCod">
                                    Cash on Delivery
                                </button>
                            </h2>
                            <div id="collapseCod" class="accordion-collapse collapse" aria-labelledby="headingCod"
                                data-bs-parent="#paymentAccordion">
                                <div class="accordion-body">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="payment_type" id="cod"
                                            value="cod">
                                        <label class="form-check-label" for="cod">
                                            Pay with cash upon delivery
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn w-100 py-3 fs-5 btn-place-order">Place Order</button>

                </div>
            </div>
        </div>

        </form>
    </div>
</div>
{% endblock %}